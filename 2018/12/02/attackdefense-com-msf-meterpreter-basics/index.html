<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.css" />
<script async defer src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.2/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#424242"
    },
    "button": {
      "background": "#2a7ae2"
    }
  },
  "content": {
    "href": "/privacy-policy"
  }
})});
</script>
  
  
  
  <title>AttackDefense.com [MSF] - Meterpreter Basics</title>
  <meta name="description" content="">
  
    
    <meta name="keywords" content="Lucian Nitescu, competition, CTF, capture, flag, chall, challange, AttackDefense.com">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://nitesculucian.github.io/2018/12/02/attackdefense-com-msf-meterpreter-basics/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Lucian Nitescu" href="https://nitesculucian.github.io/feed.xml">
  <meta name="flattr:id" content="njnwdo">
  <!-- Hotjar Tracking Code for https://nitesculucian.github.io/ -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1067531,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


    
    
    
    	
    
    	
    		
    			
    			<meta property="og:image" content="https://nitesculucian.github.io/uploads/Screenshot from 2018-10-26 17-44-27.png" alt="Image of AttackDefense 2018" " />
    			<meta name="twitter:image" content="https://nitesculucian.github.io/uploads/Screenshot from 2018-10-26 17-44-27.png" alt="Image of AttackDefense 2018" " />
    			
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    
    	
    		
        
    


  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="AttackDefense.com [MSF] - Meterpreter Basics">
  <meta name="twitter:description" content="">
  
  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet">

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-107695141-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Lucian Nitescu</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/">Home</a>
      
        
        <a class="page-link" href="/about/">Whoami</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
    </nav>
    <br>Security Blog
  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
    <h1 class="post-title" itemprop="name headline">AttackDefense.com [MSF] - Meterpreter Basics</h1>
    
    <p class="post-meta"><time datetime="2018-12-02T18:49:00-03:00" itemprop="datePublished">Dec 2, 2018</time> •
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/attackdefense-com/">AttackDefense.com</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/ctf/">ctf</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/writeups/">writeups</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
        <a href="/categories/offensive-security/">offensive_security</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/msf/">msf</a>
      
    
  



</p>
  </header>

  <hr>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- all pages -->
  <ins class="adsbygoogle"
  style="display:block"
  data-ad-client="ca-pub-0255642880549652"
  data-ad-slot="6220756861"
  data-ad-format="auto"
  data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <hr>

  <div class="post-content" itemprop="articleBody" style="word-wrap:break-word">
    <p><img src="/uploads/Screenshot from 2018-10-26 17-44-27.png" alt="Image of AttackDefense 2018" /></p>

<h3 id="mission">Mission</h3>

<p>The target server as described below is running a vulnerable web server. You have to exploit the vulnerability and get a meterpreter session on the server.  Then, you have to perform the following tasks to complete the challenge!</p>

<p>Tasks:</p>

<ul>
  <li>Check the present working directory on remote (exploited) machine.</li>
  <li>List the files present in present working directory of the remote machine.</li>
  <li>Check the present working directory on local (attacker) machine.</li>
  <li>List the files present in present working directory of the local machine.</li>
  <li>Get the flag value present in /app/flag1 file.</li>
  <li>Change the flag value present in /app/flag1, so that no one else can get the right flag.</li>
  <li>Change the present working directory to a suspiciously named directory in /app and read the flag from a hidden file present in that directory.</li>
  <li>Get the flag5.zip to local machine, open it using password 56784. The information given in the extracted file will give clue about the location of the another flag.</li>
  <li>Delete the .zip file from the directory.</li>
  <li>Print checksum of file mentioned in the extracted file (Refer to Q8).</li>
  <li>Check the PATH environment variable on the remote machine.</li>
  <li>There is a file with string “ckdo” in its name in one of the places included in PATH variable. Print the flag hidden in that file.</li>
  <li>Change to tools directory on the local machine.</li>
  <li>Upload a PHP webshell to app directory of the remote machine.</li>
</ul>

<p>Instructions:</p>

<ul>
  <li>This lab is dedicated to you! No other users are on this network :)</li>
  <li>Once you start the lab, you will have access to a root terminal of a Kali instance</li>
  <li>Your Kali has an interface with IP address 192.X.Y.Z. Run “ip addr” to know the values of X and Y.</li>
  <li>The target server should be located at the IP address 192.X.Y.3.</li>
  <li>Do not attack the gateway located at IP address 192.X.Y.1</li>
  <li>postgresql is not running by default so Metasploit may give you an error about this when starting</li>
</ul>

<p>Level difficulty: Easy</p>

<p>Category: Metasploit &gt; Meterpreter</p>

<h3 id="solution">Solution</h3>

<p>On this atypical lab I was provided with a Linux environment with root access and with two separated tasks:</p>

<ul>
  <li>Obtain access with a meterpreter session to another host.</li>
  <li>Run multiple commands by following several tasks in order to retrieve flags and understand how Metasploit works.</li>
</ul>

<p>I started by understanding the current system network connections:</p>

<p><img src="/uploads/msf1/image3.png" alt="Image of AttackDefense 2018" /></p>

<p>I decided to target the 192.247.240.0/24 internal network as such:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@attackdefense:~#</span> nmap <span class="nt">-sP</span> 192.247.240.2/24 <span class="nt">-T4</span>
</code></pre></div></div>

<p><img src="/uploads/msf1/image19.png" alt="Image of AttackDefense 2018" /></p>

<p>On this internal network, I discovered a particular 192.247.240.3 host on which I executed a <code class="highlighter-rouge">nmap</code> scan in order to retrieve all (<code class="highlighter-rouge">-p-</code>) open ports.</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@attackdefense:~#</span> nmap <span class="nt">-A</span> <span class="nt">-p-</span> <span class="nt">-T4</span> 192.247.240.3 <span class="nt">-v</span>
<span class="go">Starting Nmap 7.70 ( https://nmap.org ) at 2018-12-02 20:16 UTC
NSE: Loaded 148 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 20:16
Completed NSE at 20:16, 0.00s elapsed
Initiating NSE at 20:16
Completed NSE at 20:16, 0.00s elapsed
Initiating ARP Ping Scan at 20:16
Scanning 192.247.240.3 [1 port]
Completed ARP Ping Scan at 20:16, 0.03s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 20:16
Completed Parallel DNS resolution of 1 host. at 20:16, 0.00s elapsed
Initiating SYN Stealth Scan at 20:16
Scanning g918q3ltrwh2wjm89rxhxkbbw.temp-network_a-247-240 (192.247.240.3) [65535 ports]
Discovered open port 80/tcp on 192.247.240.3
Discovered open port 3306/tcp on 192.247.240.3
Completed SYN Stealth Scan at 20:16, 1.36s elapsed (65535 total ports)
Initiating Service scan at 20:16
Scanning 2 services on g918q3ltrwh2wjm89rxhxkbbw.temp-network_a-247-240 (192.247.240.3)
Completed Service scan at 20:16, 6.03s elapsed (2 services on 1 host)
</span><span class="gp">Initiating OS detection (try #</span>1<span class="o">)</span> against g918q3ltrwh2wjm89rxhxkbbw.temp-network_a-247-240 <span class="o">(</span>192.247.240.3<span class="o">)</span>
<span class="go">NSE: Script scanning 192.247.240.3.
Initiating NSE at 20:16
Completed NSE at 20:16, 0.13s elapsed
Initiating NSE at 20:16
Completed NSE at 20:16, 0.00s elapsed
Nmap scan report for g918q3ltrwh2wjm89rxhxkbbw.temp-network_a-247-240 (192.247.240.3)
Host is up (0.000087s latency).
Not shown: 65533 closed ports
PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.7 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
| http-git:
|   192.247.240.3:80/.git/
|     Git repository found!
</span><span class="gp">|     Repository description: Unnamed repository;</span> edit this file <span class="s1">'description'</span> to name the...
<span class="go">|     Remotes:
|_      https://github.com/fermayo/hello-world-lamp.git
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: XODA
3306/tcp open  mysql   MySQL 5.5.47-0ubuntu0.14.04.1
| mysql-info:
|   Protocol: 10
|   Version: 5.5.47-0ubuntu0.14.04.1
|   Thread ID: 2
|   Capabilities flags: 63487
|   Some Capabilities: FoundRows, ConnectWithDatabase, LongColumnFlag, SupportsLoadDataLocal, SupportsCompression, ODBCClient, Support41Auth, SupportsTransactions, IgnoreSigpipes, LongPassword, Speaks41ProtocolOld, Speaks41ProtocolNew, IgnoreSpaceBeforeParenthesis, DontAllowDatabaseTableColumn, InteractiveClient, SupportsMultipleStatments, SupportsMultipleResults, SupportsAuthPlugins
|   Status: Autocommit
</span><span class="gp">|   Salt: 5(eJ~^&gt;</span>Wz#<span class="p">;</span><span class="o">&gt;</span>c[~<span class="k">*</span>Q&lt;uZ
<span class="go">|_  Auth Plugin Name: 96
MAC Address: 02:42:C0:F7:F0:03 (Unknown)
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.9
Uptime guess: 2.178 days (since Fri Nov 30 16:00:30 2018)
Network Distance: 1 hop
TCP Sequence Prediction: Difficulty=249 (Good luck!)
IP ID Sequence Generation: All zeros

TRACEROUTE
HOP RTT     ADDRESS
1   0.09 ms g918q3ltrwh2wjm89rxhxkbbw.temp-network_a-247-240 (192.247.240.3)

NSE: Script Post-scanning.
Initiating NSE at 20:16
Completed NSE at 20:16, 0.00s elapsed
Initiating NSE at 20:16
Completed NSE at 20:16, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.74 seconds
           Raw packets sent: 65558 (2.885MB) | Rcvd: 65550 (2.623MB)
</span><span class="gp">root@attackdefense:~#</span>
</code></pre></div></div>

<p>As we can see port 80 is open therefore I decided to run a basic Nikto scan:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@attackdefense:~#</span> nikto <span class="nt">-host</span> 192.247.240.3:80
<span class="go">- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.247.240.3
+ Target Hostname:    192.247.240.3
+ Target Port:        80
+ Start Time:         2018-12-02 20:18:27 (GMT0)
---------------------------------------------------------------------------
+ Server: Apache/2.4.7 (Ubuntu)
+ Cookie PHPSESSID created without the httponly flag
+ Retrieved x-powered-by header: PHP/5.5.9-1ubuntu4.25
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Apache/2.4.7 appears to be outdated (current is at least Apache/2.4.12). Apache 2.0.65 (final release) and 2.2.29 are also current.
+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
</span><span class="gp">+ /phpinfo.php?VARIABLE=&lt;script&gt;</span>alert<span class="o">(</span><span class="s1">'Vulnerable'</span><span class="o">)</span>&lt;/script&gt;: Output from the phpinfo<span class="o">()</span> <span class="k">function </span>was found.
<span class="go">+ /config.php: PHP Config file may contain database IDs and passwords.
+ OSVDB-3268: /files/: Directory indexing found.
+ OSVDB-3092: /files/: This might be interesting...
+ /phpinfo.php: Output from the phpinfo() function was found.
+ OSVDB-3233: /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information.
+ Server leaks inodes via ETags, header found with file /README, fields: 0x21ff 0x5777f9f606580
+ OSVDB-3092: /README: README file found.
</span><span class="gp">+ /phpinfo.php?GLOBALS[test]=&lt;script&gt;</span>alert<span class="o">(</span>document.cookie<span class="o">)</span><span class="p">;</span>&lt;/script&gt;: Output from the phpinfo<span class="o">()</span> <span class="k">function </span>was found.
<span class="gp">+ /phpinfo.php?cx[]=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&lt;script&gt;</span>alert<span class="o">(</span>foo<span class="o">)</span>&lt;/script&gt;: Output from the phpinfo<span class="o">()</span> <span class="k">function </span>was found.
<span class="go">+ OSVDB-3233: /icons/README: Apache default file found.
+ OSVDB-3092: /.git/index: Git Index file may contain directory listing information.
+ /.git/HEAD: Git HEAD file found. Full repo details may be present.
+ /.git/config: Git config file found. Infos about repo details may be present.
+ 8346 requests: 0 error(s) and 21 item(s) reported on remote host
+ End Time:           2018-12-02 20:18:34 (GMT0) (7 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
</span><span class="gp">root@attackdefense:~#</span>
</code></pre></div></div>

<p>The Nikto scan did not return something interesting therefore I decided to move to a more advanced web scanner such as Arachni:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@attackdefense:~# arachni http://192.247.240.3:80
</code></pre></div></div>

<p>The output:</p>

<p><img src="/uploads/msf1/image18.png" alt="Image of AttackDefense 2018" /></p>

<p>At this point I realized there might be a known vulnerable application called <code class="highlighter-rouge">xoda</code> so I asked <code class="highlighter-rouge">msfconsole</code> to see if there is a publicly known exploit:</p>

<p><img src="/uploads/msf1/image1.png" alt="Image of AttackDefense 2018" /></p>

<p>Using the <code class="highlighter-rouge">exploit/unix/webapp/xoda_file_upload</code> exploit in msfconsole command line interface:</p>

<p><img src="/uploads/msf1/image10.png" alt="Image of AttackDefense 2018" /></p>

<p>Configuring the exploit to match our target:</p>

<p><img src="/uploads/msf1/image20.png" alt="Image of AttackDefense 2018" /></p>

<p>Running the exploit against the target and obtaining the meterpreter session as a PHP web shell through an unrestricted file upload vulnerability:</p>

<p><img src="/uploads/msf1/image5.png" alt="Image of AttackDefense 2018" /></p>

<p>Let’s proceed with the meterpreter specific tasks:</p>

<ul>
  <li>Check the present working directory on remote (exploited) machine.</li>
</ul>

<p><img src="/uploads/msf1/image15.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>List the files present in present working directory of the remote machine.</li>
</ul>

<p><img src="/uploads/msf1/image4.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Check the present working directory on local (attacker) machine.</li>
</ul>

<p><img src="/uploads/msf1/image11.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>List the files present in present working directory of the local machine.</li>
</ul>

<p><img src="/uploads/msf1/image2.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Get the flag value present in /app/flag1 file.</li>
</ul>

<p><img src="/uploads/msf1/image8.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Change the flag value present in /app/flag1, so that no one else can get the right flag.</li>
</ul>

<p><img src="/uploads/msf1/image7.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Change the present working directory to a suspiciously named directory in /app and read the flag from a hidden file present in that directory.</li>
</ul>

<p><img src="/uploads/msf1/image14.png" alt="Image of AttackDefense 2018" /></p>

<p><img src="/uploads/msf1/image12.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>This flag is also trimmed:</li>
</ul>

<p><img src="/uploads/msf1/image27.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Get the flag5.zip to local machine, open it using password 56784. The information given in the extracted file will give clue about the location of the another flag.</li>
</ul>

<p><img src="/uploads/msf1/image26.png" alt="Image of AttackDefense 2018" /></p>

<p><img src="/uploads/msf1/image25.png" alt="Image of AttackDefense 2018" /></p>

<p><img src="/uploads/msf1/image22.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Delete the .zip file from the directory.</li>
</ul>

<p><img src="/uploads/msf1/image9.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Print checksum of file mentioned in the extracted file (Refer to Q8).</li>
</ul>

<p><img src="/uploads/msf1/image16.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Check the PATH environment variable on the remote machine.</li>
</ul>

<p><img src="/uploads/msf1/image13.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>There is a file with string “ckdo” in its name in one of the places included in PATH variable. Print the flag hidden in that file.</li>
</ul>

<p><img src="/uploads/msf1/image21.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Change to tools directory on the local machine.</li>
</ul>

<p><img src="/uploads/msf1/image23.png" alt="Image of AttackDefense 2018" /></p>

<ul>
  <li>Upload a PHP webshell to app directory of the remote machine.</li>
</ul>

<p><img src="/uploads/msf1/image6.png" alt="Image of AttackDefense 2018" /></p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@attackdefense:~#</span> <span class="nb">cp</span> /usr/share/webshells/php/php-backdoor.php tools/
</code></pre></div></div>

<p><img src="/uploads/msf1/image17.png" alt="Image of AttackDefense 2018" /></p>

<p>The above-presented lab can be considered a good introduction on using meterpreter sessions and to ECCPT or OSCP like labs.</p>

<p><img src="/uploads/msf1/image24.png" alt="Image of AttackDefense 2018" /></p>

  </div>

  <hr>
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- all pages -->
  <ins class="adsbygoogle"
  style="display:block"
  data-ad-client="ca-pub-0255642880549652"
  data-ad-slot="6220756861"
  data-ad-format="auto"
  data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>


  
  <div class="post-comments" itemprop="comment">
    <hr />
<h1>Comments</h1>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://nitesculucian.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  </div>
  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; Lucian Nitescu - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://nitesculucian.github.io/feed.xml">RSS</a>

      | <a href="/privacy-policy" >Privacy Policy</a>
      | <a href="/legal-disclaimer" >Legal Disclaimer</a>
    </p>

  </div>

</footer>


  </body>

</html>
